var board=new Array,score=0,hasConflicted=new Array,startx=0,starty=0,endx=0,endy=0;function prepareForMobile(){documentWidth>500&&(gridContainerWidth=500,cellSapce=20,cellSideLength=100),$("#grid-container").css("width",gridContainerWidth-2*cellSapce),$("#grid-container").css("height",gridContainerWidth-2*cellSapce),$("#grid-container").css("padding",cellSapce),$("#grid-container").css("border-radius",.02*gridContainerWidth),$(".grid-cell").css("width",cellSideLength),$(".grid-cell").css("height",cellSideLength),$(".grid-cell").css("border-radius",.02*cellSideLength)}function newgame(){init(),generateOneNumber(),generateOneNumber()}function init(){for(var e=0;e<4;e++)for(var t=0;t<4;t++){var r=$("#grid-cell-"+e+"-"+t);r.css("top",getPosTop(e,t)),r.css("left",getPosLeft(e,t))}for(e=0;e<4;e++){board[e]=new Array,hasConflicted[e]=new Array;for(t=0;t<4;t++)board[e][t]=0,hasConflicted[e][t]=!1}updateBoardView(),score=0}function updateBoardView(){$(".number-cell").remove();for(var e=0;e<4;e++)for(var t=0;t<4;t++){$("#grid-container").append('<div class="number-cell" id="number-cell-'+e+"-"+t+'"></div>');var r=$("#number-cell-"+e+"-"+t);0==board[e][t]?(r.css("width","0px"),r.css("height","0px"),r.css("top",getPosTop(e,t)+.5*cellSideLength),r.css("left",getPosLeft(e,t)+.5*cellSideLength),r.text("")):(r.css("width",cellSideLength),r.css("height",cellSideLength),r.css("top",getPosTop(e,t)),r.css("left",getPosLeft(e,t)),r.css("background-color",getNumberBackgroundColor(board[e][t])),r.css("color",getNumberColor(board[e][t])),r.text(board[e][t])),hasConflicted[e][t]=!1}$(".number-cell").css("line-height",cellSideLength+"px"),$(".number-cell").css("font-size",.6*cellSideLength+"px")}function generateOneNumber(){if(nospace(board))return!1;for(var e=parseInt(Math.floor(4*Math.random())),t=parseInt(Math.floor(4*Math.random())),r=0;r<50&&0!=board[e][t];){e=parseInt(Math.floor(4*Math.random())),t=parseInt(Math.floor(4*Math.random()));r++}if(50==r)for(var o=0;o<4;o++)for(var n=0;n<4;n++)0==board[o][n]&&(e=o,t=n);var a=Math.random()<.5?2:4;return board[e][t]=a,showNumber(e,t,a),!0}$(document).ready(function(){prepareForMobile(),newgame()}),$(document).keydown(function(e){switch(e.keyCode){case 37:e.preventDefault(),moveLeft()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300));break;case 38:e.preventDefault(),moveUp()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300));break;case 39:e.preventDefault(),moveRight()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300));break;case 40:e.preventDefault(),moveDown()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300))}}),document.addEventListener("touchstart",function(e){e.preventDefault(),startx=e.touches[0].pageX,starty=e.touches[0].pageY}),document.addEventListener(),document.addEventListener("touchend",function(e){e.preventDefault(),endx=e.changedTouches[0].pageX,endy=e.changedTouches[0].pageY;var t=endx-startx,r=endy-starty;Math.abs(t)<.3*documentWidth&&Math.abs(r)<.3*documentWidth||(Math.abs(t)>Math.abs(r)?t>0?moveRight()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300)):moveLeft()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300)):r>0?moveDown()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300)):moveUp()&&(setTimeout("generateOneNumber()",210),setTimeout("isgameover()",300)))});